#define LP16 71

typedef struct {
  double history[LP16];
  unsigned int last_index;
} Filter_lp16;

static double filter_lp16_taps[LP16] = {
  -0.0007066425182703137,
  -0.0007268286296286886,
  -0.001063329591810064,
  -0.0014668513759914543,
  -0.0019311105457108985,
  -0.0024436254371815367,
  -0.002985003545667618,
  -0.0035287457961211376,
  -0.004041354174679216,
  -0.0044829237714309475,
  -0.004807992151209596,
  -0.004966449189797016,
  -0.004905480354430925,
  -0.004571516265203898,
  -0.003913295888858158,
  -0.0028838989778299483,
  -0.0014438517439264579,
  0.00043719870631526644,
  0.0027770974242487673,
  0.005578960108003226,
  0.00883033743051053,
  0.012501964904829027,
  0.016547151422995933,
  0.020901907450782884,
  0.025486879987390024,
  0.030209644200579106,
  0.03496563242804672,
  0.03964254994943479,
  0.04412576775820415,
  0.04829781587679349,
  0.05204846462340044,
  0.055273909995964536,
  0.05788397368747919,
  0.059804117869400535,
  0.06097903786085822,
  0.06137453690525015,
  0.06097903786085822,
  0.059804117869400535,
  0.05788397368747919,
  0.055273909995964536,
  0.05204846462340044,
  0.04829781587679349,
  0.04412576775820415,
  0.03964254994943479,
  0.03496563242804672,
  0.030209644200579106,
  0.025486879987390024,
  0.020901907450782884,
  0.016547151422995933,
  0.012501964904829027,
  0.00883033743051053,
  0.005578960108003226,
  0.0027770974242487673,
  0.00043719870631526644,
  -0.0014438517439264579,
  -0.0028838989778299483,
  -0.003913295888858158,
  -0.004571516265203898,
  -0.004905480354430925,
  -0.004966449189797016,
  -0.004807992151209596,
  -0.0044829237714309475,
  -0.004041354174679216,
  -0.0035287457961211376,
  -0.002985003545667618,
  -0.0024436254371815367,
  -0.0019311105457108985,
  -0.0014668513759914543,
  -0.001063329591810064,
  -0.0007268286296286886,
  -0.0007066425182703137
};

void filter_lp16_init(Filter_lp16* f) {
    int i;
    for(i = 0; i < LP16; ++i)
        f->history[i] = 0;
    f->last_index = 0;
}

double filter_lp16(Filter_lp16* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LP16)
    f->last_index = 0;
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LP16; ++i) {
    index = index != 0 ? index - 1 : LP16 - 1;
    acc += f->history[index] * filter_lp16_taps[i];
  };
  return acc;
}
