#define LP8LQ 35

typedef struct {
  double history[LP8LQ];
  unsigned int last_index;
} Filter_lp8lq;

static double filter_lp8lq_taps[LP8LQ] = {
  -0.0034067044860048835,
  -0.0055328010072729335,
  -0.009054310000512664,
  -0.012967623872796652,
  -0.01658109071316166,
  -0.01897384930483812,
  -0.019082619013856463,
  -0.015878583669039548,
  -0.008552308621802524,
  0.003290649374741277,
  0.01948471137211577,
  0.039234710084190834,
  0.06113414503630791,
  0.08329963969888685,
  0.10359823937453273,
  0.11992911934151995,
  0.13052040798005615,
  0.13418932903555644,
  0.13052040798005615,
  0.11992911934151995,
  0.10359823937453273,
  0.08329963969888685,
  0.06113414503630791,
  0.039234710084190834,
  0.01948471137211577,
  0.003290649374741277,
  -0.008552308621802524,
  -0.015878583669039548,
  -0.019082619013856463,
  -0.01897384930483812,
  -0.01658109071316166,
  -0.012967623872796652,
  -0.009054310000512664,
  -0.0055328010072729335,
  -0.0034067044860048835
};

void filter_lp8lq_init(Filter_lp8lq* f) {
    int i;
    for(i = 0; i < LP8LQ; ++i)
        f->history[i] = 0;
    f->last_index = 0;
}

double filter_lp8lq(Filter_lp8lq* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LP8LQ)
    f->last_index = 0;
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LP8LQ; ++i) {
    index = index != 0 ? index - 1 : LP8LQ - 1;
    acc += f->history[index] * filter_lp8lq_taps[i];
  };
  return acc;
}
