#define LP1OF8_30DB 43

typedef struct {
  double history[LP1OF8_30DB];
  unsigned int last_index;
} Filter_lp1of8_30db;

static double filter_lp1of8_30db_taps[LP1OF8_30DB] = {
  0.019356580056929827,
  0.009257163889908682,
  0.009356620668048564,
  0.007710333109708634,
  0.004153897609730854,
  -0.0011716057158218211,
  -0.007788851482189305,
  -0.01486742215927501,
  -0.02132348869722617,
  -0.025918545997753645,
  -0.027415071277073974,
  -0.024798588851664544,
  -0.017407704775725612,
  -0.005117994169122086,
  0.011615840739347232,
  0.03176195847012074,
  0.05374708791239126,
  0.07571549947606429,
  0.09555329919295284,
  0.11136907701860609,
  0.12156573303043054,
  0.12508332648795453,
  0.12156573303043054,
  0.11136907701860609,
  0.09555329919295284,
  0.07571549947606429,
  0.05374708791239126,
  0.03176195847012074,
  0.011615840739347232,
  -0.005117994169122086,
  -0.017407704775725612,
  -0.024798588851664544,
  -0.027415071277073974,
  -0.025918545997753645,
  -0.02132348869722617,
  -0.01486742215927501,
  -0.007788851482189305,
  -0.0011716057158218211,
  0.004153897609730854,
  0.007710333109708634,
  0.009356620668048564,
  0.009257163889908682,
  0.019356580056929827
};

void filter_lp1of8_30db_init(Filter_lp1of8_30db* f) {
    int i;
    for(i = 0; i < LP1OF8_30DB; ++i)
        f->history[i] = 0;
    f->last_index = 0;
}

double filter_lp1of8_30db(Filter_lp1of8_30db* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LP1OF8_30DB)
    f->last_index = 0;
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LP1OF8_30DB; ++i) {
    index = index != 0 ? index - 1 : LP1OF8_30DB - 1;
    acc += f->history[index] * filter_lp1of8_30db_taps[i];
  };
  return acc;
}
